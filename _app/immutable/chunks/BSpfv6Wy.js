import{a as x}from"./B2YICR1D.js";import{m as v,_ as D,$ as E,a0 as k,a1 as C,a2 as O,a3 as B,G as p,a4 as N}from"./DeIY3UD2.js";function $(e,t,n,s){var i=e.__style;if(v||i!==t){var r=x(t);(!v||r!==e.getAttribute("style"))&&(r==null?e.removeAttribute("style"):e.style.cssText=r),e.__style=t}return s}function h(e,t,n=!1){if(e.multiple){if(t==null)return;if(!C(t))return O();for(var s of e.options)s.selected=t.includes(l(s));return}for(s of e.options){var i=l(s);if(B(i,t)){s.selected=!0;return}}(!n||t!==void 0)&&(e.selectedIndex=-1)}function q(e){var t=new MutationObserver(()=>{h(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),k(()=>{t.disconnect()})}function G(e,t,n=t){var s=new WeakSet,i=!0;D(e,"change",r=>{var o=r?"[selected]":":checked",a;if(e.multiple)a=[].map.call(e.querySelectorAll(o),l);else{var f=e.querySelector(o)??e.querySelector("option:not([disabled])");a=f&&l(f)}n(a),p!==null&&s.add(p)}),E(()=>{var r=t();if(e===document.activeElement){var o=N??p;if(s.has(o))return}if(h(e,r,i),i&&r===void 0){var a=e.querySelector(":checked");a!==null&&(r=l(a),n(r))}e.__value=r,i=!1}),q(e)}function l(e){return"__value"in e?e.__value:e.value}const A="training_tracker_sessions",m="training_tracker_pending_deletes";function P(){return crypto.randomUUID()}function d(){return new Date().toISOString()}function c(){if(typeof localStorage>"u")return[];const e=localStorage.getItem(A);if(!e)return[];try{return JSON.parse(e)}catch{return console.error("Failed to parse cached sessions"),[]}}function u(e){typeof localStorage>"u"||localStorage.setItem(A,JSON.stringify(e))}function T(){if(typeof localStorage>"u")return[];const e=localStorage.getItem(m);if(!e)return[];try{return JSON.parse(e)}catch{return[]}}function b(e){if(typeof localStorage>"u")return;const t=T();t.includes(e)||(t.push(e),localStorage.setItem(m,JSON.stringify(t)))}function Y(e){if(typeof localStorage>"u")return;const n=T().filter(s=>s!==e);localStorage.setItem(m,JSON.stringify(n))}function y(e){const t={...e,id:P(),createdAt:d(),updatedAt:d(),syncStatus:"pending"},n=c();return n.push(t),u(n),t}function K(e,t){const n=c(),s=n.findIndex(i=>i.id===e);return s===-1?null:(n[s]={...n[s],...t,updatedAt:d(),syncStatus:"pending"},u(n),n[s])}function M(e){const t=c(),n=t.find(i=>i.id===e);if(!n)return!1;const s=t.filter(i=>i.id!==e);return u(s),(n.syncStatus==="synced"||n.syncStatus==="error")&&b(e),!0}function j(e){const t=c(),n=new Set(e);let s=0;const i=t.filter(r=>n.has(r.id));if(i.forEach(r=>{(r.syncStatus==="synced"||r.syncStatus==="error")&&b(r.id)}),new Set(i.map(r=>r.id)),s=i.length,s>0){const r=t.filter(o=>!n.has(o.id));u(r)}return s}function U(){return c().filter(e=>e.syncStatus==="pending"||e.syncStatus==="error")}function z(e){const t=c(),n=t.findIndex(s=>s.id===e);n!==-1&&(t[n].syncStatus="synced",t[n].syncedAt=d(),u(t))}function H(e){const t=c(),n=t.findIndex(s=>s.id===e);n!==-1&&(t[n].syncStatus="error",u(t))}function _(e){return c().filter(t=>t.activityType===e)}function R(e){return y({activityType:"indoor_climb",...e})}function W(e){return y({activityType:"outdoor_climb",...e})}function X(e){return y({activityType:"fingerboarding",...e})}function Q(e){return y({activityType:"competition",...e})}function V(){return _("fingerboarding")}function Z(){return _("competition")}function ee(){return _("gym_session")}function te(e){return y({activityType:"gym_session",...e})}const I="training_tracker_last_sync_";function ne(e){return typeof localStorage>"u"?null:localStorage.getItem(`${I}${e}`)}function se(e,t){typeof localStorage>"u"||localStorage.setItem(`${I}${e}`,t)}function ie(e){const t=c(),n=new Map(t.map(i=>[i.id,i]));let s=!1;for(const i of e){const r=n.get(i.id);if(r){const a=i.updatedAt?new Date(i.updatedAt).getTime():0,f=r.updatedAt?new Date(r.updatedAt).getTime():0;a>f&&(Object.assign(r,{...i,syncStatus:"synced",syncedAt:d()}),s=!0);continue}const o=t.find(a=>(a.syncStatus==="pending"||a.syncStatus==="error")&&F(a,i));if(o){o.id=i.id,o.syncStatus="synced",o.syncedAt=d(),n.set(i.id,o),s=!0;continue}t.push({...i,syncStatus:"synced",syncedAt:d()}),s=!0}s&&u(t)}function F(e,t){if(e.activityType!==t.activityType||e.date!==t.date)return!1;switch(e.activityType){case"indoor_climb":const n=e,s=t;return n.location===s.location&&n.climbingType===s.climbingType;case"outdoor_climb":const i=e,r=t;return i.area===r.area&&i.crag===r.crag;case"competition":const o=e,a=t;return o.venue===a.venue&&o.type===a.type;case"fingerboarding":const f=e,w=t;return f.location===w.location;case"gym_session":const g=e,S=t;return g.name===S.name&&g.trainingBlock===S.trainingBlock&&g.exercises.length===S.exercises.length;default:return!1}}function re(e,t){const n=c(),s=n.findIndex(i=>i.id===e);return s===-1?!1:n.some(i=>i.id===t)?(console.warn("Cannot update session ID: new ID already exists"),!1):(n[s]={...n[s],id:t},u(n),!0)}export{T as a,H as b,G as c,R as d,W as e,$ as f,U as g,te as h,q as i,ee as j,X as k,Q as l,z as m,M as n,K as o,_ as p,ne as q,Y as r,h as s,se as t,re as u,ie as v,V as w,Z as x,j as y,c as z};
