import{al as _,au as w,av as A,a0 as B,aw as E,ax as N,U as T,ao as O}from"./Uw_kZyi_.js";import{g as F}from"./CLsJli5y.js";function k(e,t,a=!1){if(e.multiple){if(t==null)return;if(!B(t))return E();for(var r of e.options)r.selected=t.includes(f(r));return}for(r of e.options){var n=f(r);if(N(n,t)){r.selected=!0;return}}(!a||t!==void 0)&&(e.selectedIndex=-1)}function D(e){var t=new MutationObserver(()=>{k(e,e.__value)});t.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),A(()=>{t.disconnect()})}function ue(e,t,a=t){var r=new WeakSet,n=!0;_(e,"change",o=>{var i=o?"[selected]":":checked",c;if(e.multiple)c=[].map.call(e.querySelectorAll(i),f);else{var h=e.querySelector(i)??e.querySelector("option:not([disabled])");c=h&&f(h)}a(c),T!==null&&r.add(T)}),w(()=>{var o=t();if(e===document.activeElement){var i=O??T;if(r.has(i))return}if(k(e,o,n),n&&o===void 0){var c=e.querySelector(":checked");c!==null&&(o=f(c),a(o))}e.__value=o,n=!1}),D(e)}function f(e){return"__value"in e?e.__value:e.value}const v="training_tracker_sessions",m="training_tracker_pending_deletes";function P(){return crypto.randomUUID()}function u(){return new Date().toISOString()}function l(){if(typeof localStorage>"u")return[];const e=localStorage.getItem(v);if(!e)return[];try{return JSON.parse(e)}catch{return console.error("Failed to parse cached sessions"),[]}}function d(e){typeof localStorage>"u"||localStorage.setItem(v,JSON.stringify(e))}function y(){if(typeof localStorage>"u")return[];const e=localStorage.getItem(m);if(!e)return[];try{return JSON.parse(e)}catch{return[]}}function I(e){if(typeof localStorage>"u")return;const t=y();t.includes(e)||(t.push(e),localStorage.setItem(m,JSON.stringify(t)))}function M(e){if(typeof localStorage>"u")return;const a=y().filter(r=>r!==e);localStorage.setItem(m,JSON.stringify(a))}function g(e){const t={...e,id:P(),createdAt:u(),updatedAt:u(),syncStatus:"pending"},a=l();return a.push(t),d(a),t}function fe(e,t){const a=l(),r=a.findIndex(n=>n.id===e);return r===-1?null:(a[r]={...a[r],...t,updatedAt:u(),syncStatus:"pending"},d(a),a[r])}function he(e){const t=l(),a=t.find(n=>n.id===e);if(!a)return!1;const r=t.filter(n=>n.id!==e);return d(r),(a.syncStatus==="synced"||a.syncStatus==="error")&&I(e),!0}function C(){return l().filter(e=>e.syncStatus==="pending"||e.syncStatus==="error")}function p(e){const t=l(),a=t.findIndex(r=>r.id===e);a!==-1&&(t[a].syncStatus="synced",t[a].syncedAt=u(),d(t))}function b(e){const t=l(),a=t.findIndex(r=>r.id===e);a!==-1&&(t[a].syncStatus="error",d(t))}function W(e){return l().filter(t=>t.activityType===e)}function ye(e){return g({activityType:"indoor_climb",...e})}function ge(e){return g({activityType:"outdoor_climb",...e})}function Te(e){return g({activityType:"fingerboarding",...e})}function pe(e){return g({activityType:"competition",...e})}function Se(){return W("fingerboarding")}function me(){return W("competition")}function be(e){const t=l(),a=new Set(t.map(n=>n.id));let r=!1;for(const n of e){if(a.has(n.id))continue;const o=t.find(i=>(i.syncStatus==="pending"||i.syncStatus==="error")&&R(i,n));if(o){o.id=n.id,o.syncStatus="synced",o.syncedAt=u(),a.add(n.id),r=!0;continue}t.push({...n,syncStatus:"synced",syncedAt:u()}),r=!0}r&&d(t)}function R(e,t){if(e.activityType!==t.activityType||e.date!==t.date)return!1;switch(e.activityType){case"indoor_climb":const a=e,r=t;return a.location===r.location&&a.climbingType===r.climbingType;case"outdoor_climb":const n=e,o=t;return n.area===o.area&&n.crag===o.crag;case"competition":const i=e,c=t;return i.venue===c.venue&&i.type===c.type;case"fingerboarding":const h=e,L=t;return h.location===L.location;default:return!1}}function $(e,t){const a=l(),r=a.findIndex(n=>n.id===e);return r===-1?!1:a.some(n=>n.id===t)?(console.warn("Cannot update session ID: new ID already exists"),!1):(a[r]={...a[r],id:t},d(a),!0)}const x="https://func-workout-api-825153765638.europe-west1.run.app";async function s(e,t={}){const a=F();if(!a)return{ok:!1,error:"Not authenticated"};try{const r=await fetch(`${x}${e}`,{...t,headers:{"Content-Type":"application/json","x-api-key":a,...t.headers}});return r.ok?r.status===204?{ok:!0}:{ok:!0,data:await r.json()}:{ok:!1,error:`HTTP ${r.status}: ${r.statusText}`}}catch(r){return{ok:!1,error:r instanceof Error?r.message:"Network error"}}}async function U(e){const t=await s("/indoor_sessions",{method:"POST",body:JSON.stringify(e)});return t.ok&&t.data?{ok:!0,id:t.data.id}:{ok:!1,error:t.error}}async function G(e,t){return s(`/indoor_sessions/${e}`,{method:"PUT",body:JSON.stringify(t)})}async function ke(){return s("/indoor_sessions",{method:"GET"})}async function H(e){return s(`/indoor_sessions/${e}`,{method:"DELETE"})}function q(){return typeof navigator<"u"?navigator.onLine:!0}async function Q(e){const t=await s("/outdoor_sessions",{method:"POST",body:JSON.stringify(e)});return t.ok&&t.data?{ok:!0,id:t.data.id}:{ok:!1,error:t.error}}async function J(e,t){return s(`/outdoor_sessions/${e}`,{method:"PUT",body:JSON.stringify(t)})}async function ve(){return s("/outdoor_sessions",{method:"GET"})}async function V(e){return s(`/outdoor_sessions/${e}`,{method:"DELETE"})}async function K(e){const t=await s("/fingerboard_sessions",{method:"POST",body:JSON.stringify(e)});return t.ok&&t.data?{ok:!0,id:t.data.id}:{ok:!1,error:t.error}}async function j(e,t){return s(`/fingerboard_sessions/${e}`,{method:"PUT",body:JSON.stringify(t)})}async function Ce(){return s("/fingerboard_sessions",{method:"GET"})}async function Z(e){return s(`/fingerboard_sessions/${e}`,{method:"DELETE"})}async function z(e){const t=await s("/competition_sessions",{method:"POST",body:JSON.stringify(e)});return t.ok&&t.data?{ok:!0,id:t.data.id}:{ok:!1,error:t.error}}async function Y(e,t){return s(`/competition_sessions/${e}`,{method:"PUT",body:JSON.stringify(t)})}async function We(){return s("/competition_sessions",{method:"GET"})}async function X(e){return s(`/competition_sessions/${e}`,{method:"DELETE"})}const S={Portland:{"Blacknor Far North":["Far North (Pit Prop Crag - North Wing)","Far North (Pit Prop Crag - South Wing)","Sunstone Wall","Sandcastle Wall","Hidden Wall"],"Blacknor North":["Diamond Slab","The Ledge","Sharpy's Wall","Reptile Smile Area","Wolfgang Forever Area","Captain Klutz Area","Death of Cool Area","Seattle Be The Day Area","Blacknor Heights (Blacknor Quarry Bouldering)","Blacknor Fort Quarry (Sport)","Cliff Top Way Down"],"Blacknor Central":["The Veranda","Medusa Wall","The Battlement","Wave Wall","Mirror Wall"],"Blacknor South":["Fallen Slab","Infidel Slab","Englands Dreaming Area","Sacred Angel Area","The Reach","Shit Happens Wall"],"Blacknor Far South":["Deadman's Bay","The White Hole","Wall of Lament"],"Battleship Edge":["Northern Sector","Main Edge","Battleship Block"],"Battleship Back Cliff":["Zinc Oxide Mountain","The Main Cliff","Sleepy Hollow"],"Wallsend North":["Sweet Smell of Success Wall","The Coastguard Wall (Northern section)"],"Wallsend South":["The Upper Tier","The Lower Tier","Stalker's Zone"],"Coastguard North":["Top Tier","Main Cliff (Beeston Bump)","The Grooves"],"Coastguard South":["The White Wall","Tennessee Wall","The Veranda (South)"],Godnor:["Godnor North","Godnor Far South","The Godnor Gate Area"],Neddyfields:["Neddyfields Main Wall","The Flowstone Wall","Neddyfields Bouldering"],"Cheyne Cliff":["Red Wall","Inception Wall","Road Rage Wall","The Nook","The Block"],"The Cuttings":["The Cuttings (Main Cliff)","The Pulpit","The Bower","Sun Lover's Slab"],"The New Cuttings":["The Gallery","The Annex","The Arches","The Grotto"],"The Cuttings Boulderfield":["The Tractor","The Coffin","The Octagon","Lightning Wall"]},Swanage:{"Dancing Ledge":["The Amphitheatre","The Upper Tier","The Skull","Promenade","The Quarry"],Hedbury:["Hedbury Quarry (Main)","Hedbury Sea Cliff (The Big Wall)"],Winspit:["The West Quarry","The East Quarry (The Playground)","The Sea Walls"]},"Wye Valley":{"Ban-y-Gor":["The Main Wall","The River Wall","The Far Left","The Upper Tier"],"Biblins Cave":["The Main Cave","The Right Wall","The Entrance Area"],"Woodcroft Quarry":["Fly Wall","The Main Quarry","The Retaining Wall"],"Wyndcliff Quarry":["The Main Wall (Left & Right)","The Upper Tier","The Shady Wall"]},"Costa Del Severn":{Brean:["Boulder Cove","The River Face (Main Cliff)","The Fort","The Slab"],Clevedon:["Ladye Bay","Marine Lake (Bouldering)","The Sea Walls"],"Portishead Quarry":["The Main Wall","The Slab","The Upper Tier"]},Bristol:{"Avon Gorge":["Sea Walls","Suspension Bridge Buttress","Morning Slab","Main Wall","New Quarry","The Amphitheatre","Unknown Wall"],"Leigh Woods":["Quarry 1","Quarry 2","The Main Buttress"],"Bickley Wood":["The Main Wall","The Stream Wall"],Hambrook:["The Roadside Wall"]},Cotswolds:{"Sally-in-the-Wood":["The Main Edge","The Boulders"],"Browns Folly":["The Tower","The Main Wall","The Upper Wall","The Far Right"]},Mendips:{"Cheddar Gorge":["High Rock","Sunset Buttress","Lion Rock","The Pinnacles","Acid Rock","Coronation Street","Long Rock"]},Gower:{Rhossili:["Shipwreck Cove","Rhossili Upper Cliff","The Tears Point"],"Trial Wall Area":["Trial Wall","The Terraces"],Foxhole:["The Main Cave","The Slab","The Overhangs"]},"South Wales":{"Dinas Rock":["Kennelgarth Wall","Main Overhang","Roadside Crag","The Inland Slabs"],Ogmore:["The Deep Zawn","Hardy's Bay","The Diamond","Daytona Wall"]},"North Wales":{"Cromlech (Dinas Cromlech)":["The Corner (Cenotaph)","Left Wall","Right Wall"],"Australia (Slate Quarries)":["The Sidings","Looning the Tube Area","Dali's Hole","The Salt Pans"]},"Peak District":{"Burbage South Valley":["The Boulders","The Edge (The Alliance Area)","The Tank"],"Gardoms Edge":["Apple Buttress","The Eye of Faith","Moomin Buttress"],"Raven Tor":["The Main Wall","The Weedkiller Wall"],Stanage:["Popular End","Plantation","High Neb","Stanage North","The End","Stanage Far North"],"Curbar Edge":["The Main Edge","Elder Crack Area"]},Devon:{Dartmoor:["Haytor (Low Man)","Hound Tor","The Dewerstone (Main Cliff)","Bonehill Rocks"],Hartland:["Screda Point","Smoothlands","Blackchurch Rock"],Tintagel:["The Great Cliff","Gull Rock","Ila's Ledge"]}};function Le(){return Object.keys(S)}function _e(e){return S[e]?Object.keys(S[e]):[]}async function we(){const e={success:0,failed:0,errors:[]};if(!q())return e.errors.push("No network connection"),e;const t=y();for(const r of t)try{let n=!1;(await H(r)).ok&&(n=!0),n||(await V(r)).ok&&(n=!0),n||(await Z(r)).ok&&(n=!0),n||(await X(r)).ok&&(n=!0),M(r),e.success++}catch(n){e.errors.push(`Delete ${r}: ${n instanceof Error?n.message:"Unknown error"}`)}const a=C();for(const r of a)try{const n=await ee(r);if(n.ok){if(!r.syncedAt&&n.id&&n.id!==r.id){const i=$(r.id,n.id);p(i?n.id:r.id)}else p(r.id);e.success++}else b(r.id),e.failed++,e.errors.push(`Session ${r.id}: ${n.error||"Unknown error"}`)}catch(n){b(r.id),e.failed++,e.errors.push(`Session ${r.id}: ${n instanceof Error?n.message:"Unknown error"}`)}return e}async function ee(e){const t=!!e.syncedAt;switch(e.activityType){case"indoor_climb":return t?re(e):te(e);case"outdoor_climb":return t?ae(e):ne(e);case"fingerboarding":return t?ie(e):oe(e);case"competition":return t?ce(e):se(e);default:return{ok:!1,error:`Unknown activity type: ${e.activityType}`}}}async function te(e){const t={date:e.date,location:e.location,customLocation:e.customLocation,climbingType:e.climbingType,trainingTypes:e.trainingTypes,difficulty:e.difficulty,categories:e.categories,energySystems:e.energySystems,techniqueFocuses:e.techniqueFocuses,wallAngles:e.wallAngles,fingerLoad:e.fingerLoad,shoulderLoad:e.shoulderLoad,forearmLoad:e.forearmLoad,climbs:e.climbs};return U(t)}async function re(e){const t={date:e.date,location:e.location,customLocation:e.customLocation,climbingType:e.climbingType,trainingTypes:e.trainingTypes,difficulty:e.difficulty,categories:e.categories,energySystems:e.energySystems,techniqueFocuses:e.techniqueFocuses,wallAngles:e.wallAngles,fingerLoad:e.fingerLoad,shoulderLoad:e.shoulderLoad,forearmLoad:e.forearmLoad,climbs:e.climbs};return G(e.id,t)}async function ne(e){const t={date:e.date,area:e.area,crag:e.crag,sector:e.sector,climbingType:e.climbingType,trainingTypes:e.trainingTypes,difficulty:e.difficulty,categories:e.categories,energySystems:e.energySystems,techniqueFocuses:e.techniqueFocuses,fingerLoad:e.fingerLoad,shoulderLoad:e.shoulderLoad,forearmLoad:e.forearmLoad,climbs:e.climbs};return Q(t)}async function ae(e){const t={date:e.date,area:e.area,crag:e.crag,sector:e.sector,climbingType:e.climbingType,trainingTypes:e.trainingTypes,difficulty:e.difficulty,categories:e.categories,energySystems:e.energySystems,techniqueFocuses:e.techniqueFocuses,fingerLoad:e.fingerLoad,shoulderLoad:e.shoulderLoad,forearmLoad:e.forearmLoad,climbs:e.climbs};return J(e.id,t)}async function oe(e){const t={date:e.date,location:e.location,exercises:e.exercises};return K(t)}async function ie(e){const t={date:e.date,location:e.location,exercises:e.exercises};return j(e.id,t)}async function se(e){const t={date:e.date,venue:e.venue,customVenue:e.customVenue,type:e.type,fingerLoad:e.fingerLoad,shoulderLoad:e.shoulderLoad,forearmLoad:e.forearmLoad,rounds:e.rounds};return z(t)}async function ce(e){const t={date:e.date,venue:e.venue,customVenue:e.customVenue,type:e.type,fingerLoad:e.fingerLoad,shoulderLoad:e.shoulderLoad,forearmLoad:e.forearmLoad,rounds:e.rounds};return Y(e.id,t)}function Ae(){return C().length+y().length}export{me as A,We as B,q as a,ue as b,ye as c,U as d,b as e,ge as f,Le as g,Q as h,D as i,_e as j,Te as k,K as l,p as m,pe as n,z as o,Ae as p,we as q,he as r,k as s,W as t,fe as u,ke as v,be as w,ve as x,Se as y,Ce as z};
