import{n as h,q as I,v as A,w as T,x as w,y as x,z as g,A as D}from"./Tby4OOB_.js";function m(e,n,t=!1){if(e.multiple){if(n==null)return;if(!T(n))return w();for(var i of e.options)i.selected=n.includes(f(i));return}for(i of e.options){var r=f(i);if(x(r,n)){i.selected=!0;return}}(!t||n!==void 0)&&(e.selectedIndex=-1)}function C(e){var n=new MutationObserver(()=>{m(e,e.__value)});n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),A(()=>{n.disconnect()})}function N(e,n,t=n){var i=new WeakSet,r=!0;h(e,"change",s=>{var o=s?"[selected]":":checked",a;if(e.multiple)a=[].map.call(e.querySelectorAll(o),f);else{var l=e.querySelector(o)??e.querySelector("option:not([disabled])");a=l&&f(l)}t(a),g!==null&&i.add(g)}),I(()=>{var s=n();if(e===document.activeElement){var o=D??g;if(i.has(o))return}if(m(e,s,r),r&&s===void 0){var a=e.querySelector(":checked");a!==null&&(s=f(a),t(s))}e.__value=s,r=!1}),C(e)}function f(e){return"__value"in e?e.__value:e.value}const p="training_tracker_sessions",y="training_tracker_pending_deletes";function E(){return crypto.randomUUID()}function d(){return new Date().toISOString()}function c(){if(typeof localStorage>"u")return[];const e=localStorage.getItem(p);if(!e)return[];try{return JSON.parse(e)}catch{return console.error("Failed to parse cached sessions"),[]}}function u(e){typeof localStorage>"u"||localStorage.setItem(p,JSON.stringify(e))}function v(){if(typeof localStorage>"u")return[];const e=localStorage.getItem(y);if(!e)return[];try{return JSON.parse(e)}catch{return[]}}function k(e){if(typeof localStorage>"u")return;const n=v();n.includes(e)||(n.push(e),localStorage.setItem(y,JSON.stringify(n)))}function B(e){if(typeof localStorage>"u")return;const t=v().filter(i=>i!==e);localStorage.setItem(y,JSON.stringify(t))}function S(e){const n={...e,id:E(),createdAt:d(),updatedAt:d(),syncStatus:"pending"},t=c();return t.push(n),u(t),n}function J(e,n){const t=c(),i=t.findIndex(r=>r.id===e);return i===-1?null:(t[i]={...t[i],...n,updatedAt:d(),syncStatus:"pending"},u(t),t[i])}function P(e){const n=c(),t=n.find(r=>r.id===e);if(!t)return!1;const i=n.filter(r=>r.id!==e);return u(i),(t.syncStatus==="synced"||t.syncStatus==="error")&&k(e),!0}function F(){return c().filter(e=>e.syncStatus==="pending"||e.syncStatus==="error")}function K(e){const n=c(),t=n.findIndex(i=>i.id===e);t!==-1&&(n[t].syncStatus="synced",n[t].syncedAt=d(),u(n))}function L(e){const n=c(),t=n.findIndex(i=>i.id===e);t!==-1&&(n[t].syncStatus="error",u(n))}function _(e){return c().filter(n=>n.activityType===e)}function U(e){return S({activityType:"indoor_climb",...e})}function Y(e){return S({activityType:"outdoor_climb",...e})}function j(e){return S({activityType:"fingerboarding",...e})}function z(e){return S({activityType:"competition",...e})}function G(){return _("fingerboarding")}function H(){return _("competition")}function M(e){const n=c(),t=new Set(n.map(r=>r.id));let i=!1;for(const r of e){if(t.has(r.id))continue;const s=n.find(o=>(o.syncStatus==="pending"||o.syncStatus==="error")&&O(o,r));if(s){s.id=r.id,s.syncStatus="synced",s.syncedAt=d(),t.add(r.id),i=!0;continue}n.push({...r,syncStatus:"synced",syncedAt:d()}),i=!0}i&&u(n)}function O(e,n){if(e.activityType!==n.activityType||e.date!==n.date)return!1;switch(e.activityType){case"indoor_climb":const t=e,i=n;return t.location===i.location&&t.climbingType===i.climbingType;case"outdoor_climb":const r=e,s=n;return r.area===s.area&&r.crag===s.crag;case"competition":const o=e,a=n;return o.venue===a.venue&&o.type===a.type;case"fingerboarding":const l=e,b=n;return l.location===b.location;default:return!1}}function W(e,n){const t=c(),i=t.findIndex(r=>r.id===e);return i===-1?!1:t.some(r=>r.id===n)?(console.warn("Cannot update session ID: new ID already exists"),!1):(t[i]={...t[i],id:n},u(t),!0)}function Q(){typeof localStorage>"u"||(localStorage.removeItem(p),localStorage.removeItem(y),window.location.reload())}export{v as a,L as b,N as c,U as d,Y as e,j as f,F as g,z as h,C as i,P as j,J as k,_ as l,K as m,M as n,G as o,H as p,Q as q,B as r,m as s,c as t,W as u};
