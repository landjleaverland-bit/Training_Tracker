import{a as x}from"./B2YICR1D.js";import{m as _,_ as w,$ as D,a0 as k,a1 as E,a2 as C,a3 as B,G as p,a4 as O}from"./DeIY3UD2.js";function G(e,n,t,s){var i=e.__style;if(_||i!==n){var r=x(n);(!_||r!==e.getAttribute("style"))&&(r==null?e.removeAttribute("style"):e.style.cssText=r),e.__style=n}return s}function h(e,n,t=!1){if(e.multiple){if(n==null)return;if(!E(n))return C();for(var s of e.options)s.selected=n.includes(f(s));return}for(s of e.options){var i=f(s);if(B(i,n)){s.selected=!0;return}}(!t||n!==void 0)&&(e.selectedIndex=-1)}function N(e){var n=new MutationObserver(()=>{h(e,e.__value)});n.observe(e,{childList:!0,subtree:!0,attributes:!0,attributeFilter:["value"]}),k(()=>{n.disconnect()})}function K(e,n,t=n){var s=new WeakSet,i=!0;w(e,"change",r=>{var o=r?"[selected]":":checked",c;if(e.multiple)c=[].map.call(e.querySelectorAll(o),f);else{var y=e.querySelector(o)??e.querySelector("option:not([disabled])");c=y&&f(y)}t(c),p!==null&&s.add(p)}),D(()=>{var r=n();if(e===document.activeElement){var o=O??p;if(s.has(o))return}if(h(e,r,i),i&&r===void 0){var c=e.querySelector(":checked");c!==null&&(r=f(c),t(r))}e.__value=r,i=!1}),N(e)}function f(e){return"__value"in e?e.__value:e.value}const b="training_tracker_sessions",m="training_tracker_pending_deletes";function q(){return crypto.randomUUID()}function d(){return new Date().toISOString()}function a(){if(typeof localStorage>"u")return[];const e=localStorage.getItem(b);if(!e)return[];try{return JSON.parse(e)}catch{return console.error("Failed to parse cached sessions"),[]}}function u(e){typeof localStorage>"u"||localStorage.setItem(b,JSON.stringify(e))}function A(){if(typeof localStorage>"u")return[];const e=localStorage.getItem(m);if(!e)return[];try{return JSON.parse(e)}catch{return[]}}function I(e){if(typeof localStorage>"u")return;const n=A();n.includes(e)||(n.push(e),localStorage.setItem(m,JSON.stringify(n)))}function L(e){if(typeof localStorage>"u")return;const t=A().filter(s=>s!==e);localStorage.setItem(m,JSON.stringify(t))}function l(e){const n={...e,id:q(),createdAt:d(),updatedAt:d(),syncStatus:"pending"},t=a();return t.push(n),u(t),n}function U(e,n){const t=a(),s=t.findIndex(i=>i.id===e);return s===-1?null:(t[s]={...t[s],...n,updatedAt:d(),syncStatus:"pending"},u(t),t[s])}function Y(e){const n=a(),t=n.find(i=>i.id===e);if(!t)return!1;const s=n.filter(i=>i.id!==e);return u(s),(t.syncStatus==="synced"||t.syncStatus==="error")&&I(e),!0}function j(e){const n=a(),t=new Set(e);let s=0;const i=n.filter(r=>t.has(r.id));if(i.forEach(r=>{(r.syncStatus==="synced"||r.syncStatus==="error")&&I(r.id)}),new Set(i.map(r=>r.id)),s=i.length,s>0){const r=n.filter(o=>!t.has(o.id));u(r)}return s}function H(){return a().filter(e=>e.syncStatus==="pending"||e.syncStatus==="error")}function M(e){const n=a(),t=n.findIndex(s=>s.id===e);t!==-1&&(n[t].syncStatus="synced",n[t].syncedAt=d(),u(n))}function W(e){const n=a(),t=n.findIndex(s=>s.id===e);t!==-1&&(n[t].syncStatus="error",u(n))}function v(e){return a().filter(n=>n.activityType===e)}function $(e){return l({activityType:"indoor_climb",...e})}function z(e){return l({activityType:"outdoor_climb",...e})}function Q(e){return l({activityType:"fingerboarding",...e})}function R(e){return l({activityType:"competition",...e})}function V(){return v("fingerboarding")}function X(){return v("competition")}function Z(){return v("gym_session")}function ee(e){return l({activityType:"gym_session",...e})}function ne(e){const n=a(),t=new Set(n.map(i=>i.id));let s=!1;for(const i of e){if(t.has(i.id))continue;const r=n.find(o=>(o.syncStatus==="pending"||o.syncStatus==="error")&&J(o,i));if(r){r.id=i.id,r.syncStatus="synced",r.syncedAt=d(),t.add(i.id),s=!0;continue}n.push({...i,syncStatus:"synced",syncedAt:d()}),s=!0}s&&u(n)}function J(e,n){if(e.activityType!==n.activityType||e.date!==n.date)return!1;switch(e.activityType){case"indoor_climb":const t=e,s=n;return t.location===s.location&&t.climbingType===s.climbingType;case"outdoor_climb":const i=e,r=n;return i.area===r.area&&i.crag===r.crag;case"competition":const o=e,c=n;return o.venue===c.venue&&o.type===c.type;case"fingerboarding":const y=e,T=n;return y.location===T.location;case"gym_session":const g=e,S=n;return g.name===S.name&&g.trainingBlock===S.trainingBlock&&g.exercises.length===S.exercises.length;default:return!1}}function te(e,n){const t=a(),s=t.findIndex(i=>i.id===e);return s===-1?!1:t.some(i=>i.id===n)?(console.warn("Cannot update session ID: new ID already exists"),!1):(t[s]={...t[s],id:n},u(t),!0)}export{A as a,W as b,K as c,$ as d,z as e,G as f,H as g,ee as h,N as i,Z as j,Q as k,R as l,M as m,Y as n,U as o,v as p,ne as q,L as r,h as s,V as t,te as u,X as v,j as w,a as x};
